<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academia 4.3.1">
  <meta name="generator" content="Hugo 0.124.1">

  

  
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="What we&#39;re doing at my new startup [Network Next](https://networknext.com) :rocket:">

  
  <link rel="alternate" hreflang="en-us" href="https://gafferongames.com/post/fixing_the_internet_for_games/">

  


  

  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academiaons/1.8.6/css/academiaons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Open+Sans|Roboto+Mono&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academia.min.88bfd34630258dde91b90e40ca4fc6a8.css">

  

  
  
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://gafferongames.com/post/fixing_the_internet_for_games/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Gaffer On Games">
  <meta property="og:url" content="https://gafferongames.com/post/fixing_the_internet_for_games/">
  <meta property="og:title" content="Fixing the Internet for Games | Gaffer On Games">
  <meta property="og:description" content="What we&#39;re doing at my new startup [Network Next](https://networknext.com) :rocket:"><meta property="og:image" content="https://gafferongames.com/img/icon-192.png">
  <meta property="twitter:image" content="https://gafferongames.com/img/icon-192.png"><meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-03-24T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2019-03-24T00:00:00&#43;00:00">
  

  


  





  <title>Fixing the Internet for Games | Gaffer On Games</title>

</head>


<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Gaffer On Games</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation"><span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Articles</span></a>
        </li>

        
        

      

        

        

        

        

      </ul>

    </div>
  </div>
</nav>


  <article class="article py-5" itemscope itemtype="http://schema.org/Article">

  












    

    
    
    
    <div class="article-container py-3">
      <h1 itemprop="name">Fixing the Internet for Games</h1>

      

      
      



<meta content="2019-03-24 00:00:00 &#43;0000 UTC" itemprop="datePublished">
<meta content="2019-03-24 00:00:00 &#43;0000 UTC" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Mar 24, 2019</time>
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    8 min read
  </span>
  

  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    <a href="/categories/game-networking/">Game Networking</a></span>
  

  
    

  

</div>

      














      
      
    </div>
  </div>
</div>

  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      <hr>
<p>Hello readers, I&rsquo;m no longer posting new content on gafferongames.com</p>
<h3 id="please-check-out-my-new-blog-at-mas-bandwidthcomhttpsmas-bandwidthcomxdp-for-game-programmers">Please check out my new blog at <a href="https://mas-bandwidth.com/xdp-for-game-programmers">mas-bandwidth.com</a>!</h3>
<hr>
<p>Hi, I&rsquo;m <a href="https://gafferongames.com">Glenn Fiedler</a> and this is my GDC 2019 talk called “Fixing the Internet for Games”.</p>
<img src="/img/fixing-the-internet/001.png" width="100%" class="image_border"/>
<p>It&rsquo;s about what we are doing at my new startup <a href="https://networknext.com">Network Next</a>.</p>
<img src="/img/fixing-the-internet/002.png" width="100%" class="image_border"/>
<p>When you launch a multiplayer game, some percentage of your player base will complain they are getting a bad experience.</p>
<p>You only need to check your forums to see this is true.</p>
<p>And as a player you’ve probably experienced it too.</p>
<p>What’s going on?</p>
<img src="/img/fixing-the-internet/003.png" width="100%" class="image_border"/>
<p>Is it your netcode, or maybe your matchmaker or hosting provider?</p>
<p>Can you fix it by running more servers in additional locations, or by switching to another hosting company?</p>
<p>Or maybe you’ve done all this already and now you have too many data centers, causing fragmentation in your player base?</p>
<img src="/img/fixing-the-internet/004.png" width="100%" class="image_border"/>
<p>It turns out that you can do all these things perfectly yet some % of your player base will still complain.</p>
<p>The real problem is that you don’t control the route from your player to your game server, and sometimes this route is bad.</p>
<img src="/img/fixing-the-internet/005.png" width="100%" class="image_border"/>
<p>This happens because the internet is not optimized for what we want (lowest latency, jitter and packet loss)</p>
<p>No amount of good netcode that you write can compensate for this.</p>
<p>The problem is the internet itself.</p>
<p>The internet doesn’t care about your game.</p>
<img src="/img/fixing-the-internet/006.png" width="100%" class="image_border"/>
<p>The internet thinks game traffic is the same as checking emails, visiting a website or watching netflix.</p>
<p>But game traffic is real-time and latency sensitive. It’s not the same.</p>
<p>It’s interactive so it can’t be cached at the edge and buffered like streamed video.</p>
<p>Networks that participate in the internet do hot potato routing, they just try to get your packets off their network as fast as possible so they don’t have to deal with it anymore. Nobody is coordinating centrally to ensure that packets are delivered with the lowest overall latency, jitter and packet loss.</p>
<p>Sometimes ISPs or transit providers make mistakes and packets are sent on ridiculous routes that can go to the other side of the country and back on their way to a game server just 5 miles away from the player… you can call up the ISP and ask them to fix this, but it can take days to resolve.</p>
<p>Even from day to day, performance is not consistent. You can get a good route one day, and a terrible one the next.</p>
<p>For all of these problems, players tend to blame you, the developer. But it’s not actually your fault.</p>
<img src="/img/fixing-the-internet/007.png" width="100%" class="image_border"/>
<p>What can you, the game developer, do about this?</p>
<img src="/img/fixing-the-internet/008.png" width="100%" class="image_border"/>
<p>One common approach is to try running as many servers in as many locations as possible, with as many different providers as you can.</p>
<p>This seems like a good idea at first, but there is no one data center or hosting company that is perfectly peered with every player of your game, so ultimately, it does not solve the problem.</p>
<p>Flaws:</p>
<ol>
<li>Player fragmentation</li>
<li>Logistics of so many suppliers</li>
<li>Really difficult to find one data center suitable for party or team that wants to play together</li>
</ol>
<img src="/img/fixing-the-internet/009.png" width="100%" class="image_border"/>
<p>Another option is to host in public clouds. Google’s private network is pretty good, right?</p>
<p>Game developers tend to assume that AWS, Azure and Google peering is perfect. But this is not true.</p>
<p>Flaws:</p>
<ol>
<li>Egress bandwidth is expensive</li>
<li>Locked into one provider</li>
<li>Transit is not as good as you think</li>
</ol>
<img src="/img/fixing-the-internet/010.png" width="100%" class="image_border"/>
<p>You could also build your own internet for your game.</p>
<p>This is not a joke. It actually happened!</p>
<p>Riot built their own private internet for League of Legends. When you play league of legends, your game traffic goes directly from your ISP onto this private network.</p>
<p>Case study: Riot Direct</p>
<ul>
<li><a href="https://technology.riotgames.com/news/fixing-internet-real-time-applications-part-i">Fixing the internet for real-time applications (part 1)</a></li>
<li><a href="https://technology.riotgames.com/news/fixing-internet-real-time-applications-part-ii">Fixing the internet for real-time applications (part 2)</a></li>
<li><a href="https://technology.riotgames.com/news/fixing-internet-real-time-applications-part-iii">Fixing the internet for real-time applications (part 3)</a></li>
</ul>
<p>Flaws:</p>
<ol>
<li>Can you really afford this?</li>
<li>How many internets do we really need?! :)</li>
</ol>
<img src="/img/fixing-the-internet/011.png" width="100%" class="image_border"/>
<p>Right now, if you are a game developer shipping a multiplayer game, you are competing against companies that have built their own private internet for their game.</p>
<img src="/img/fixing-the-internet/012.png" width="100%" class="image_border"/>
<p>What’s the solution? Build your own too?</p>
<p>Does it really make sense to build an internet for each game? This is crazy&hellip;</p>
<p>There has to be a way to do this without building your own infrastructure.</p>
<img src="/img/fixing-the-internet/013.png" width="100%" class="image_border"/>
<p>Network Next was created to solve this problem.</p>
<img src="/img/fixing-the-internet/014.png" width="100%" class="image_border"/>
<p>Network Next steers your game’s traffic across private networks that have already been built, so you don’t have to build your own private internet for your game.</p>
<img src="/img/fixing-the-internet/015.png" width="100%" class="image_border"/>
<p>But hold on. Aren&rsquo;t all the problems at the edge?</p>
<p>People seem to think that all the bad stuff on the internet occurs at the edge of the network, eg. shitty DSL connections, oversubscribed cable networks…</p>
<p>But this is not true.</p>
<img src="/img/fixing-the-internet/016.png" width="100%" class="image_border"/>
<p>The backbone itself is not as good as you think it is.</p>
<img src="/img/fixing-the-internet/017.png" width="100%" class="image_border"/>
<p>And I’m going to prove it.</p>
<img src="/img/fixing-the-internet/018.png" width="100%" class="image_border"/>
<p>Just two regular computers sitting in different data centers&hellip; let’s send UDP ping and pong packets between them, so we can measure the quality of the network.</p>
<img src="/img/fixing-the-internet/019.png" width="100%" class="image_border"/>
<p>We need some way to measure this quality as a scalar value.</p>
<p>Define cost as the sum of round trip time (rtt) in milliseconds, jitter (3rd standard deviation), and packet loss %.</p>
<p>Lower cost is good. Higher cost is bad.</p>
<img src="/img/fixing-the-internet/020.png" width="100%" class="image_border"/>
<p>Now let’s generalize to 4 nodes.</p>
<p>We measure cost between all nodes via pings, O(n^2).</p>
<img src="/img/fixing-the-internet/021.png" width="100%" class="image_border"/>
<p>Now let’s go up to 10 nodes.</p>
<img src="/img/fixing-the-internet/022.png" width="100%" class="image_border"/>
<p>Store the cost between all nodes in a triangular matrix.</p>
<p>Each entry in the matrix is the cost between the node with index corresponding to the column, and node with index corresponding to the row.</p>
<p>The diagonal is -1, because nodes don’t ping themselves.</p>
<img src="/img/fixing-the-internet/023.png" width="100%" class="image_border"/>
<p>Now spin up instances in all the providers you can think of and all locations they support in North America.</p>
<p>For example: Google, AWS, Azure, Bluemix, vultr.com, multiplay, i3d, gameservers.com, servers.com and so on.</p>
<img src="/img/fixing-the-internet/024.png" width="100%" class="image_border"/>
<p>If the internet backbone was perfectly efficient, A-B would be the lowest cost 100% of the time.</p>
<p>Instead, for the worst provider it is only 5-10% of the time.</p>
<p>And the best performing provider only 30% of the time&hellip;</p>
<p>Of course, we are not outperforming each provider on their own internal network, those are efficient.</p>
<p>Instead we reveal that each node on the internet is not perfectly peered with every other node. There is some slack, and going through an intermediary node in the majority cases can fix this.</p>
<img src="/img/fixing-the-internet/025.png" width="100%" class="image_border"/>
<p>Machines on the backbone are not talking to each other as efficiently as they can.</p>
<p>Talking through an intermediary is often better, in terms of our cost function.</p>
<p>Why? Many reasons&hellip; but overall, the public internet is optimized for throughput at lowest cost, not lowest latency and jitter.</p>
<img src="/img/fixing-the-internet/026.png" width="100%" class="image_border"/>
<p>What other option is there, aside from the public internet?</p>
<img src="/img/fixing-the-internet/027.png" width="100%" class="image_border"/>
<p>Many private networks have been built.</p>
<p>These include CDNs and any corporate entity that has realized the public internet is broken, and have built their own private networks (backhaul) and interconnections to compensate.</p>
<p>(Not many people know this, but this “shadow” private internet is actually growing at a faster rate than the public internet&hellip;)</p>
<img src="/img/fixing-the-internet/028.png" width="100%" class="image_border"/>
<p>This private internet is currently closed. Your game packets do not traverse it.</p>
<p>How can we open it up?</p>
<img src="/img/fixing-the-internet/029.png" width="100%" class="image_border"/>
<p>With a marketplace. Network Next is a marketplace where private networks resell excess capacity to applications that want better transit than the public internet.</p>
<img src="/img/fixing-the-internet/030.png" width="100%" class="image_border"/>
<p>Every 10 seconds, per-player we run a &ldquo;route shader&rdquo; as a bid on our marketplace, and find the best route across multiple suppliers that satisfies this request.</p>
<p>Suppliers cannot identify buyers, and can only compete on performance and price.</p>
<p>Thus, Network Next discovers the market price for premium transit, while remaining neutral.</p>
<img src="/img/fixing-the-internet/031.png" width="100%" class="image_border"/>
<p>Now let’s see how it works in practice, with real players.</p>
<img src="/img/fixing-the-internet/032.png" width="100%" class="image_border"/>
<p>Here is a small sample of connections active at a specific time one night last week&hellip;</p>
<p>Each dot is a player. Green dots are taking Network Next, blue dots are taking the public internet, because Network Next does not provide any improvement for them (yet).</p>
<p>Around 60% of player sessions are improved, fluctuating between 50% and 60% depending on the time of day. We believe that as we ramp up more suppliers, we can get the percentage of players improved up to 90%.</p>
<img src="/img/fixing-the-internet/033.png" width="100%" class="image_border"/>
<p>Of the 60% that are currently improved, the improvement breaks down into the following buckets:</p>
<p>49% of sessions had 0-5 cost unit improvement (cost being latency+jitter+packet loss).
25% had 5-10cu improvement.
12% had 10-15cu improvement.
6% had 15-20cu improvement.
7% had greater than 20cu improvement&hellip;</p>
<img src="/img/fixing-the-internet/034.png" width="100%" class="image_border"/>
<p>Here is a look at live sessions at a random time that night. Look at the rightmost column. Some players are getting an incredible improvement&hellip; there are always some players getting improvements like this at all times of the day&hellip;</p>
<p>(My apologies for the black censoring, it is necessary for GDPR compliance).</p>
<img src="/img/fixing-the-internet/035.png" width="100%" class="image_border"/>
<p>Drilling into the session getting the most improvement, we can see that they are not in the middle of nowhere, they are in Monterey, California&hellip;</p>
<img src="/img/fixing-the-internet/036.png" width="100%" class="image_border"/>
<p>Here we can see that the improvement is in both latency and jitter. Notice how flat the blue latency line is (Network Next), vs. the red line (public internet) that is going all over the place.</p>
<p>Network Next not only has lower latency, it is also more consistent.</p>
<img src="/img/fixing-the-internet/037.png" width="100%" class="image_border"/>
<p>Here is a look at different data centers where our customers run game servers.</p>
<p>On the right is the % of players taking Network Next (getting improvement) to servers in that data center (green), and those not getting improvement and going direct over the public internet (blue).</p>
<p>On the left is the distribution of cost unit improvements for players that are getting improvement on Network Next to servers in that data center. The improvement depends on the peering arrangements of that data center, and on internet weather. It fluctuates somewhat from day to day.</p>
<p>We are able to fix this fluctuation due to internet weather and get the best result at all times.</p>
<img src="/img/fixing-the-internet/040.png" width="100%" class="image_border"/>
<p>If you&rsquo;d like to learn more, please visit us at <a href="https://networknext.com">networknext.com</a></p>
<hr>
<p>Hello readers, I&rsquo;m no longer posting new content on gafferongames.com</p>
<h3 id="please-check-out-my-new-blog-at-mas-bandwidthcomhttpsmas-bandwidthcomxdp-for-game-programmers-1">Please check out my new blog at <a href="https://mas-bandwidth.com/xdp-for-game-programmers">mas-bandwidth.com</a>!</h3>
<hr>

    </div>

    

<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/networking/">networking</a>
  
</div>



    
      








  
  
  





  
  
  
  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="/authors/"></a></h5>
      
      
      <ul class="network-icon" aria-hidden="true">
        
      </ul>
    </div>
  </div>



      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/post/networked_physics_in_virtual_reality/">Networked Physics in Virtual Reality</a></li>
          
          <li><a href="/post/why_cant_i_send_udp_packets_from_a_browser/">Why can&#39;t I send UDP packets from a browser?</a></li>
          
          <li><a href="/post/client_server_connection/">Client Server Connection</a></li>
          
          <li><a href="/post/reliable_ordered_messages/">Reliable Ordered Messages</a></li>
          
          <li><a href="/post/sending_large_blocks_of_data/">Sending Large Blocks of Data</a></li>
          
        </ul>
      </div>
      
    

    

    


  </div>
</article>

      

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    

    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    <script src="/js/academia.min.6402f830cb6203c1b15935e7789e48da.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">

  <div class="container">
    <div class="row">
      <div class="col-md-6">
        
        <p>
          Copyright © Glenn Fiedler, 2004 - 2024 
        </p>
      </div>
      <div class="col-md-6">
        <ul class="list-inline network-icon text-right">
          
          
        </ul>
      </div>
    </div>
  </div>
</footer>
  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
